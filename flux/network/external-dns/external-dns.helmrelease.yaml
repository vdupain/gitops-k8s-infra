apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: external-dns
  namespace: external-dns
spec:
  chart:
    spec:
      chart: external-dns
      version: 7.3.0
      sourceRef:
        kind: HelmRepository
        name: bitnami
        namespace: flux-system
  interval: 15m
  timeout: 5m
  releaseName: external-dns

  values:
    crd:
      ## @param crd.create Install and use the integrated DNSEndpoint CRD
      ##
      create: true
    sources:
      - crd
      - service
      - ingress
    logLevel: debug
    # Pihole only supports A/AAAA/CNAME records so there is no mechanism to track ownership.
    # You don't need to set this flag, but if you leave it unset, you will receive warning
    # logs when ExternalDNS attempts to create TXT records.
    registry: noop      
    # IMPORTANT: If you have records that you manage manually in Pi-hole, set
    # the policy to upsert-only so they do not get deleted.    
    policy: upsert-only

    provider: pihole
    pihole:
      server: http://192.168.10.4/
      secretName: pihole
      tlsSkipVerify: true